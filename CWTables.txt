
create schema TicketSystem;
set search_path to TicketSystem;

CREATE TABLE Staff
(
	StaffID		INTEGER PRIMARY KEY,
	Name			VARCHAR(40) NOT NULL
		check (Name <> '')
);

CREATE TABLE Product
(
	ProductID		INTEGER PRIMARY KEY,
	Name			VARCHAR(40) NOT NULL
		check (Name <> '')
);

CREATE TABLE Customer
(
	CustomerID		INTEGER PRIMARY KEY,
	Name			VARCHAR(40) NOT NULL
		check (Name <> ''),
	Email			VARCHAR(40) NOT NULL UNIQUE
		check (Email <> '')
);

CREATE TABLE Ticket
(
	TicketID		INTEGER PRIMARY KEY,
	Problem		VARCHAR(1000) NOT NULL
		check (Problem <> ''),
	Status		VARCHAR(20) NOT NULL
		CHECK (Status in ('open', 'closed')),
	Priority		INTEGER NOT NULL
		CHECK (Priority >= 1 and Priority <= 3),
	LoggedTime		TIMESTAMP NOT NULL,
	CustomerID		INTEGER NOT NULL,
	FOREIGN KEY (CustomerID) REFERENCES Customer
			ON DELETE RESTRICT
			ON UPDATE RESTRICT,
	ProductID		INTEGER NOT NULL,
	FOREIGN KEY (ProductID) REFERENCES Product
			ON DELETE RESTRICT
			ON UPDATE RESTRICT,
);

CREATE TABLE TicketUpdate
(
	TicketUpdateID	INTEGER PRIMARY KEY,
	Message		VARCHAR(1000) NOT NULL
		check (Message <> ''),
	UpdateTime		TIMESTAMP NOT NULL,
	TicketID		INTEGER NOT NULL,
	FOREIGN KEY (TicketID) REFERENCES Ticket
			ON DELETE RESTRICT
			ON UPDATE RESTRICT,
	StaffID		INTEGER,
	FOREIGN KEY (StaffID) REFERENCES Staff
			ON DELETE RESTRICT
			ON UPDATE RESTRICT,
);

--EXPECT INDEX INSTRUCTIONS HERE